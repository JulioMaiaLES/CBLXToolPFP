{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@app/services/engage.service\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"../../services/progress.service\";\nimport * as i5 from \"../../../app/services/sidebar.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/router\";\nimport * as i8 from \"../../components/jornada/menu/menu.component\";\nfunction EngageComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"textarea\", 19);\n    i0.ɵɵlistener(\"keydown.enter\", function EngageComponent_div_28_Template_textarea_keydown_enter_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const i_r6 = restoredCtx.index;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.onFormSubmit($event, \"big_idea\", i_r6));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r6 = ctx.index;\n    i0.ɵɵproperty(\"formGroupName\", i_r6);\n  }\n}\nfunction EngageComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"textarea\", 19);\n    i0.ɵɵlistener(\"keydown.enter\", function EngageComponent_div_36_Template_textarea_keydown_enter_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const i_r10 = restoredCtx.index;\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.onFormSubmit($event, \"essential_question\", i_r10));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r10 = ctx.index;\n    i0.ɵɵproperty(\"formGroupName\", i_r10);\n  }\n}\nfunction EngageComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"textarea\", 19);\n    i0.ɵɵlistener(\"keydown.enter\", function EngageComponent_div_44_Template_textarea_keydown_enter_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const i_r14 = restoredCtx.index;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.onFormSubmit($event, \"challenge\", i_r14));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r14 = ctx.index;\n    i0.ɵɵproperty(\"formGroupName\", i_r14);\n  }\n}\nfunction EngageComponent_div_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20)(1, \"p\", 21);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const file_r17 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Arquivo: \", file_r17.name, \"\");\n  }\n}\nfunction EngageComponent_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵelement(1, \"img\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const image_r18 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", image_r18.value, i0.ɵɵsanitizeUrl);\n  }\n}\nexport class EngageComponent {\n  toggleMenu() {\n    this.sidebarService.toggleSidebar(); // Delegate toggling to the SidebarService\n  }\n\n  constructor(fb, engageService, dialog, dialogRef, progressService, sidebarService) {\n    this.fb = fb;\n    this.engageService = engageService;\n    this.dialog = dialog;\n    this.dialogRef = dialogRef;\n    this.progressService = progressService;\n    this.sidebarService = sidebarService;\n    this.engageData = {\n      big_idea: [],\n      essential_question: [],\n      challenge: []\n    };\n    this.isMenuHidden = true; // Explicitly declare boolean type (optional)\n    this.files = []; // No changes needed, already correctly typed\n    this.renderedFiles = []; // Properly typed with the interface defined\n    this.images = []; // No changes needed, correctly typed\n    this.fileReader = new FileReader(); // No changes needed, properly initialized\n    this.objectUrls = []; // Initialized properly to hold URLs\n  }\n\n  ngOnInit() {\n    this.engageForm = this.fb.group({\n      big_idea: this.fb.array([this.createField()]),\n      essential_question: this.fb.array([this.createField()]),\n      challenge: this.fb.array([this.createField()])\n    });\n    this.loadEngageData();\n  }\n  loadEngageData() {\n    this.engageService.getEngage().subscribe({\n      next: response => {\n        if (response.data) {\n          this.engageData = response.data;\n          this.populateForm();\n          console.log('Engage data loaded successfully', this.engageData);\n        } else {\n          console.error('Unexpected response format:', response);\n        }\n      },\n      error: error => console.error('Failed to load engage data:', error)\n    });\n  }\n  populateForm() {\n    // Destructure engageData with default values\n    const {\n      big_idea = '',\n      essential_question = '',\n      challenge = ''\n    } = this.engageData;\n    // Convert to arrays properly\n    this.setFields('big_idea', this.convertToArray(big_idea));\n    this.setFields('essential_question', this.convertToArray(essential_question));\n    this.setFields('challenge', this.convertToArray(challenge));\n  }\n  // Update this function to handle empty strings correctly\n  convertToArray(data) {\n    if (Array.isArray(data)) {\n      return data;\n    } else if (typeof data === 'string') {\n      if (data.trim() === '') {\n        return ['']; // Return array with an empty string to create a text area\n      }\n\n      return data.split(','); // Split by commas or another delimiter if needed\n    }\n\n    return []; // Return an empty array if the data is null or not a valid string\n  }\n\n  setFields(fieldName, fieldData) {\n    const formArray = this.engageForm.get(fieldName);\n    formArray.clear(); // Clear existing FormArray\n    // Create form controls for each entry in fieldData, including empty strings\n    fieldData.forEach(data => {\n      formArray.push(this.fb.group({\n        content: [data, Validators.required]\n      }));\n    });\n  }\n  get bigIdeaFields() {\n    return this.engageForm.get('big_idea');\n  }\n  get essentialQuestionFields() {\n    return this.engageForm.get('essential_question');\n  }\n  get challengeFields() {\n    return this.engageForm.get('challenge');\n  }\n  createField() {\n    return this.fb.group({\n      content: ['', Validators.required]\n    });\n  }\n  addFields(fieldName, count) {\n    const control = this.engageForm.get(fieldName);\n    // Instead of pushing multiple at once, map through and add each individually\n    for (let i = 0; i < count; i++) {\n      control.push(this.createField());\n    }\n  }\n  saveDataWithDebounce(formData) {\n    // Clear the existing timeout if there's one\n    if (this.saveTimeout) clearTimeout(this.saveTimeout);\n    // Set a new timeout to debounce the save operation\n    this.saveTimeout = setTimeout(() => {\n      this.saveData(formData).subscribe({\n        next: response => console.log('Data saved successfully', response),\n        error: error => console.error('Failed to save data:', error)\n      });\n    }, 500); // Adjust debounce time as needed\n  }\n\n  onFormSubmit(event, fieldName, index) {\n    event.preventDefault();\n    const fieldArray = this.engageForm.get(fieldName);\n    const field = fieldArray.at(index); // Get the specific field by index\n    if (!field.valid) {\n      console.log('Field is empty or invalid. Aborting submission.');\n      return;\n    }\n    // Get the new value from the form field\n    const fieldValue = field.get('content')?.value.trim();\n    if (fieldValue) {\n      // Ensure engageData is properly updated\n      if (Array.isArray(this.engageData[fieldName])) {\n        // If engageData[fieldName] is an array, update it accordingly\n        this.engageData[fieldName].splice(index, 1, fieldValue);\n      } else {\n        // Otherwise, assign the new value directly\n        this.engageData[fieldName] = fieldValue;\n      }\n    }\n    // Save all filled fields with debounce to avoid repeated saves\n    this.saveDataWithDebounce(this.engageData);\n    // Optionally, add a new field after the current one is submitted\n    this.addFields(fieldName, 1);\n  }\n  saveData(formData) {\n    return this.engageService.createOrUpdateEngage(formData);\n  }\n  updateProgress() {\n    this.progressService.answeredQuestions++;\n    this.progressService.engageProgress = Math.round(this.progressService.answeredQuestions / this.progressService.totalQuestions * 100);\n  }\n  onFileSelected(event) {\n    const inputElement = event?.target;\n    if (inputElement && inputElement.files) {\n      const files = inputElement.files;\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const renderType = this.determineRenderType(file);\n        const renderedFile = {\n          file,\n          renderType\n        };\n        if (renderType === 'pdf') {\n          renderedFile.downloadUrl = this.getFileUrl(file);\n        }\n        this.renderedFiles.push(renderedFile);\n      }\n    }\n  }\n  determineRenderType(file) {\n    if (file.type.includes('image')) {\n      return 'image';\n    } else if (file.type.includes('pdf')) {\n      return 'pdf';\n    } else {\n      return 'other';\n    }\n  }\n  getFileUrl(file) {\n    const url = URL.createObjectURL(file);\n    this.objectUrls.push(url); // Track URLs for cleanup\n    return url;\n  }\n  cleanupObjectUrls() {\n    this.objectUrls.forEach(url => URL.revokeObjectURL(url));\n    this.objectUrls = [];\n  }\n  downloadFile(file) {\n    const url = this.getFileUrl(file);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = file.name;\n    a.click();\n  }\n  handleKeyboardEvent(event) {\n    if (event.key === '/') {\n      clearTimeout(this.debounceTimer);\n      this.debounceTimer = setTimeout(() => this.openModal(), 300);\n    }\n  }\n  openModal() {\n    import('@app/components/modal/modal.component').then(({\n      ModalComponent\n    }) => {\n      const dialogRef = this.dialog.open(ModalComponent, {\n        width: '250px'\n      });\n      dialogRef.afterClosed().subscribe(files => {\n        if (files && files.length > 0) {\n          this.processFiles(files); // Delegate file processing to a helper method\n        }\n      });\n    });\n  }\n  // Helper method to process files\n  processFiles(files) {\n    const fileArray = Array.from(files); // Convert FileList to an array once\n    fileArray.forEach(file => {\n      if (this.isImage(file)) {\n        this.imageRenderer(file); // Process image files\n      } else {\n        this.files.push(file); // Store non-image files in this.files\n      }\n    });\n    // Optional: Log the processed files or remove this in production\n    console.log('Non-image files:', this.files);\n  }\n  // Check if the file is an image based on its type\n  isImage(file) {\n    return file.type.startsWith('image/');\n  }\n  // Image rendering method\n  imageRenderer(file) {\n    this.fileReader.onload = () => {\n      this.images.push({\n        name: file.name,\n        value: this.fileReader.result // Store image as base64 string\n      });\n    };\n\n    this.fileReader.readAsDataURL(file); // Read the image file as a Data URL\n  }\n\n  autoResize(event) {\n    const target = event.target;\n    if (target.scrollHeight !== target.clientHeight) {\n      target.style.height = 'auto';\n      target.style.height = target.scrollHeight + 'px';\n    }\n  }\n  static #_ = this.ɵfac = function EngageComponent_Factory(t) {\n    return new (t || EngageComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.EngageService), i0.ɵɵdirectiveInject(i3.MatDialog), i0.ɵɵdirectiveInject(i3.MatDialogRef), i0.ɵɵdirectiveInject(i4.ProgressService), i0.ɵɵdirectiveInject(i5.SidebarService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EngageComponent,\n    selectors: [[\"app-engage\"]],\n    hostBindings: function EngageComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"keydown\", function EngageComponent_keydown_HostBindingHandler($event) {\n          return ctx.handleKeyboardEvent($event);\n        }, false, i0.ɵɵresolveDocument);\n      }\n    },\n    decls: 47,\n    vars: 6,\n    consts: [[1, \"cabecalho\"], [1, \"tree\"], [\"routerLink\", \"/jornada\", 1, \"subir\"], [1, \"navegacao\"], [1, \"nav-engage-select\"], [\"routerLink\", \"/investigate\", 1, \"nav-acessar\"], [\"routerLink\", \"/act\", 1, \"nav-acessar\"], [3, \"formGroup\"], [\"formArrayName\", \"big_idea\", 1, \"step-container\"], [1, \"align-vertical\"], [\"src\", \"../../../assets/images/big_idea.png\", \"alt\", \"lampada\"], [3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [\"formArrayName\", \"essential_question\", 1, \"step-container\"], [\"src\", \"../../../assets/images/essential_question.png\", \"alt\", \"pensando\"], [\"formArrayName\", \"challenge\", 1, \"step-container\"], [\"src\", \"../../../assets/images/challenge.png\", \"alt\", \"alvo\"], [\"class\", \"archives\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"images\", 4, \"ngFor\", \"ngForOf\"], [3, \"formGroupName\"], [\"formControlName\", \"content\", \"type\", \"text\", 1, \"textos\", 3, \"keydown.enter\"], [1, \"archives\"], [1, \"title-archive\"], [1, \"images\"], [\"alt\", \"Uploaded Image\", 3, \"src\"]],\n    template: function EngageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"header\")(1, \"div\", 0)(2, \"div\", 1);\n        i0.ɵɵtext(3, \" Projetos > \");\n        i0.ɵɵelementStart(4, \"a\", 2);\n        i0.ɵɵtext(5, \"Projeto CBL\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(6, \" > \");\n        i0.ɵɵelementStart(7, \"b\");\n        i0.ɵɵtext(8, \" Engage\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"div\", 3)(10, \"ul\")(11, \"li\", 4);\n        i0.ɵɵtext(12, \"Engage\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"li\")(14, \"a\", 5);\n        i0.ɵɵtext(15, \"Investigate\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(16, \"li\")(17, \"a\", 6);\n        i0.ɵɵtext(18, \"Act\");\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelement(19, \"app-menu\");\n        i0.ɵɵelementStart(20, \"body\")(21, \"form\", 7)(22, \"div\", 8)(23, \"label\", 9);\n        i0.ɵɵelement(24, \"img\", 10);\n        i0.ɵɵtext(25, \" Big Idea \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(26, \"br\")(27, \"br\");\n        i0.ɵɵtemplate(28, EngageComponent_div_28_Template, 2, 1, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(29, \"br\");\n        i0.ɵɵelementStart(30, \"div\", 12)(31, \"label\", 9);\n        i0.ɵɵelement(32, \"img\", 13);\n        i0.ɵɵtext(33, \" Essential Question \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(34, \"br\")(35, \"br\");\n        i0.ɵɵtemplate(36, EngageComponent_div_36_Template, 2, 1, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(37, \"br\");\n        i0.ɵɵelementStart(38, \"div\", 14)(39, \"label\", 9);\n        i0.ɵɵelement(40, \"img\", 15);\n        i0.ɵɵtext(41, \" Challenge \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(42, \"br\")(43, \"br\");\n        i0.ɵɵtemplate(44, EngageComponent_div_44_Template, 2, 1, \"div\", 11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(45, EngageComponent_div_45_Template, 3, 1, \"div\", 16);\n        i0.ɵɵtemplate(46, EngageComponent_div_46_Template, 2, 1, \"div\", 17);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(21);\n        i0.ɵɵproperty(\"formGroup\", ctx.engageForm);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngForOf\", ctx.bigIdeaFields.controls);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.essentialQuestionFields.controls);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.challengeFields.controls);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.files);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.images);\n      }\n    },\n    dependencies: [i6.NgForOf, i7.RouterLink, i8.MenuComponent, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i1.FormGroupName, i1.FormArrayName],\n    styles: [\"@charset \\\"UTF-8\\\";\\nhtml[_ngcontent-%COMP%], body[_ngcontent-%COMP%] {\\n  background-color: var(--main-color);\\n  min-height: 100vh;\\n  font-family: Roboto, sans-serif;\\n}\\n\\nheader[_ngcontent-%COMP%] {\\n  background-color: var(--main-color);\\n  color: white;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  margin: 0;\\n  position: relative;\\n  padding-top: 5%;\\n  padding-bottom: 2%;\\n}\\nheader[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\\n  list-style: none;\\n  padding: 0;\\n  margin: 0;\\n}\\nheader[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\\n  display: inline-block;\\n  margin: 0px 10px;\\n  color: white;\\n}\\nheader[_ngcontent-%COMP%]   .cabecalho[_ngcontent-%COMP%] {\\n  width: 50%;\\n}\\nheader[_ngcontent-%COMP%]   .tree[_ngcontent-%COMP%] {\\n  font-size: 30px;\\n  padding-left: 10%;\\n  display: flex;\\n  font-family: Helvetica, Bold;\\n  align-items: center;\\n  gap: 10px;\\n}\\nheader[_ngcontent-%COMP%]   .tree[_ngcontent-%COMP%]    > *[_ngcontent-%COMP%] {\\n  display: inline-block;\\n}\\nheader[_ngcontent-%COMP%]   .nav-acessar[_ngcontent-%COMP%] {\\n  color: white;\\n  text-decoration: none;\\n}\\nheader[_ngcontent-%COMP%]   .nav-acessar[_ngcontent-%COMP%]:hover {\\n  text-decoration: underline;\\n}\\nheader[_ngcontent-%COMP%]   .subir[_ngcontent-%COMP%] {\\n  font-size: 30px;\\n  color: white;\\n  text-decoration: none;\\n}\\nheader[_ngcontent-%COMP%]   .subir[_ngcontent-%COMP%]:hover {\\n  text-decoration: underline;\\n}\\n\\nh1[_ngcontent-%COMP%] {\\n  font-size: 40px;\\n  color: white;\\n  font-family: Roboto, sans-serif;\\n  font-weight: 450;\\n}\\n\\nform[_ngcontent-%COMP%] {\\n  padding: 0 450px;\\n}\\nform[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\\n  font-size: 28px;\\n  color: white;\\n}\\nform[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::placeholder {\\n  color: white;\\n  opacity: 1;\\n}\\nform[_ngcontent-%COMP%]   .textos[_ngcontent-%COMP%] {\\n  width: 100%;\\n  min-width: 150px;\\n  resize: none;\\n  overflow: hidden;\\n  background-color: transparent;\\n  color: white;\\n  border: none;\\n  font-family: Roboto, \\\"Helvetica Neue\\\", sans-serif;\\n  font-size: 22px;\\n  line-height: 24px;\\n  outline: none; \\n\\n}\\nform[_ngcontent-%COMP%]   .align-vertical[_ngcontent-%COMP%] {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 30px;\\n}\\n\\n.investigate[_ngcontent-%COMP%] {\\n  position: fixed;\\n  height: 100%;\\n  border: transparent;\\n  background-color: rgb(145, 225, 54);\\n  width: 75px;\\n  top: 0;\\n  right: 0;\\n  cursor: pointer;\\n}\\n\\n.engage-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  margin-bottom: 20px; \\n\\n}\\n\\n.engage-image[_ngcontent-%COMP%] {\\n  margin-right: 20px; \\n\\n}\\n\\n.engage-title[_ngcontent-%COMP%] {\\n  margin-top: 20px; \\n\\n}\\n\\n.essential-questioning[_ngcontent-%COMP%] {\\n  background-color: rgb(252, 43, 22);\\n  border: 2px solid white;\\n  color: white;\\n  padding: 16px 32px;\\n  text-align: center;\\n  font-size: 16px;\\n  margin: 250px 2px;\\n  opacity: 0.6;\\n  transition: 0.3s;\\n  height: 60px;\\n  display: inline-block;\\n  text-decoration: none;\\n  cursor: pointer;\\n  margin-left: 100px;\\n  margin-top: 10px;\\n  margin-bottom: 0;\\n}\\n\\n.essential-questioning[_ngcontent-%COMP%]:hover {\\n  opacity: 1;\\n}\\n\\n.title-archive[_ngcontent-%COMP%] {\\n  margin-left: 100px;\\n  font-size: 14px;\\n  color: white;\\n}\\n\\n.button-archive[_ngcontent-%COMP%] {\\n  margin-left: 100px;\\n  background-color: rgb(1, 155, 158);\\n  border: 2px solid white;\\n  color: white;\\n  text-align: center;\\n  font-size: 14px;\\n  opacity: 0.6;\\n  transition: 0.3s;\\n  height: 30px;\\n  display: inline-block;\\n  text-decoration: none;\\n  cursor: pointer;\\n}\\n\\n.button-archive[_ngcontent-%COMP%]:hover {\\n  opacity: 1;\\n}\\n\\n.file-list[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n  height: 60vh;\\n}\\n\\n.file-list[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  gap: 10px; \\n\\n}\\n\\n.file-list[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\\n  margin: 0; \\n\\n}\\n\\n.step-container[_ngcontent-%COMP%] {\\n  background-color: #262626;\\n  padding: 20px;\\n  border-radius: 10px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvZW5nYWdlL2VuZ2FnZS5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnQkFBZ0I7QUFBaEI7RUFDSSxtQ0FBQTtFQUNBLGlCQUFBO0VBQ0EsK0JBQUE7QUFFSjs7QUFHQTtFQUNJLG1DQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSw4QkFBQTtFQUNBLG1CQUFBO0VBQ0EsU0FBQTtFQUNBLGtCQUFBO0VBQ0EsZUFBQTtFQUNBLGtCQUFBO0FBQUo7QUFHSTtFQUNJLGdCQUFBO0VBQ0EsVUFBQTtFQUNBLFNBQUE7QUFEUjtBQUdRO0VBQ0kscUJBQUE7RUFDQSxnQkFBQTtFQUNBLFlBQUE7QUFEWjtBQUtJO0VBQ0ksVUFBQTtBQUhSO0FBTUk7RUFDSSxlQUFBO0VBQ0EsaUJBQUE7RUFDQSxhQUFBO0VBQ0EsNEJBQUE7RUFDQSxtQkFBQTtFQUtBLFNBQUE7QUFSUjtBQUlRO0VBQ0kscUJBQUE7QUFGWjtBQVVJO0VBQ0ksWUFBQTtFQUNBLHFCQUFBO0FBUlI7QUFXSTtFQUNJLDBCQUFBO0FBVFI7QUFZSTtFQUNJLGVBQUE7RUFDQSxZQUFBO0VBQ0EscUJBQUE7QUFWUjtBQWFJO0VBQ0ksMEJBQUE7QUFYUjs7QUFlQTtFQUNJLGVBQUE7RUFDQSxZQUFBO0VBQ0EsK0JBQUE7RUFDQSxnQkFBQTtBQVpKOztBQWVBO0VBQ0ksZ0JBQUE7QUFaSjtBQWNJO0VBQ0ksZUFBQTtFQUNBLFlBQUE7QUFaUjtBQWVJO0VBQ0ksWUFBQTtFQUNBLFVBQUE7QUFiUjtBQWdCSTtFQUNJLFdBQUE7RUFDQSxnQkFBQTtFQUNBLFlBQUE7RUFDQSxnQkFBQTtFQUNBLDZCQUFBO0VBQ0EsWUFBQTtFQUNBLFlBQUE7RUFDQSxpREFBQTtFQUNBLGVBQUE7RUFDQSxpQkFBQTtFQUNBLGFBQUEsRUFBQSx3Q0FBQTtBQWRSO0FBaUJJO0VBQ0ksb0JBQUE7RUFDQSxtQkFBQTtFQUNBLFNBQUE7QUFmUjs7QUFvQkE7RUFDSSxlQUFBO0VBQ0EsWUFBQTtFQUNBLG1CQUFBO0VBQ0EsbUNBQUE7RUFDQSxXQUFBO0VBQ0EsTUFBQTtFQUNBLFFBQUE7RUFDQSxlQUFBO0FBakJKOztBQW9CQTtFQUNJLGFBQUE7RUFDQSx1QkFBQTtFQUNBLG1CQUFBO0VBQ0EsbUJBQUEsRUFBQSwyREFBQTtBQWpCSjs7QUFvQkE7RUFDSSxrQkFBQSxFQUFBLHNDQUFBO0FBakJKOztBQW9CQTtFQUNJLGdCQUFBLEVBQUEsMEJBQUE7QUFqQko7O0FBd0JBO0VBQ0ksa0NBQUE7RUFDQSx1QkFBQTtFQUNBLFlBQUE7RUFDQSxrQkFBQTtFQUNBLGtCQUFBO0VBQ0EsZUFBQTtFQUNBLGlCQUFBO0VBQ0EsWUFBQTtFQUNBLGdCQUFBO0VBQ0EsWUFBQTtFQUNBLHFCQUFBO0VBQ0EscUJBQUE7RUFDQSxlQUFBO0VBQ0Esa0JBQUE7RUFDQSxnQkFBQTtFQUNBLGdCQUFBO0FBckJKOztBQXdCQTtFQUE4QixVQUFBO0FBcEI5Qjs7QUFzQkE7RUFDSSxrQkFBQTtFQUNBLGVBQUE7RUFDQSxZQUFBO0FBbkJKOztBQXNCQTtFQUNJLGtCQUFBO0VBQ0Esa0NBQUE7RUFDQSx1QkFBQTtFQUNBLFlBQUE7RUFDQSxrQkFBQTtFQUNBLGVBQUE7RUFDQSxZQUFBO0VBQ0EsZ0JBQUE7RUFDQSxZQUFBO0VBQ0EscUJBQUE7RUFDQSxxQkFBQTtFQUNBLGVBQUE7QUFuQko7O0FBc0JBO0VBQXVCLFVBQUE7QUFsQnZCOztBQW9CQTtFQUNJLGFBQUE7RUFDQSxzQkFBQTtFQUNBLHVCQUFBO0VBQ0EsbUJBQUE7RUFDQSxZQUFBO0FBakJKOztBQW9CQTtFQUNJLGFBQUE7RUFDQSxtQkFBQTtFQUNBLG1CQUFBO0VBQ0EsU0FBQSxFQUFBLG1DQUFBO0FBakJKOztBQW9CQTtFQUNJLFNBQUEsRUFBQSwwQkFBQTtBQWpCSjs7QUFvQkE7RUFDSSx5QkFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtBQWpCSiIsInNvdXJjZXNDb250ZW50IjpbImh0bWwsIGJvZHl7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbWFpbi1jb2xvcik7XG4gICAgbWluLWhlaWdodDogMTAwdmg7XG4gICAgZm9udC1mYW1pbHk6IFJvYm90bywgc2Fucy1zZXJpZjtcblxufVxuXG5cbmhlYWRlciB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbWFpbi1jb2xvcik7XG4gICAgY29sb3I6IHdoaXRlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgbWFyZ2luOiAwO1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBwYWRkaW5nLXRvcDogNSU7XG4gICAgcGFkZGluZy1ib3R0b206IDIlO1xuXG4gIFxuICAgIHVsIHtcbiAgICAgICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgbWFyZ2luOiAwO1xuICBcbiAgICAgICAgbGkge1xuICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICAgICAgbWFyZ2luOiAwcHggMTBweDtcbiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC5jYWJlY2FsaG97XG4gICAgICAgIHdpZHRoOiA1MCVcbiAgICB9XG5cbiAgICAudHJlZXtcbiAgICAgICAgZm9udC1zaXplOiAzMHB4O1xuICAgICAgICBwYWRkaW5nLWxlZnQ6IDEwJTtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgZm9udC1mYW1pbHk6IEhlbHZldGljYSwgQm9sZDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgPiAqIHtcbiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgfVxuICAgICAgICAvLyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgZ2FwOiAxMHB4O1xuXG4gICAgfVxuICAgIFxuXG4gICAgLm5hdi1hY2Vzc2Fye1xuICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICB9XG5cbiAgICAubmF2LWFjZXNzYXI6aG92ZXJ7XG4gICAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xuICAgIH1cblxuICAgIC5zdWJpcntcbiAgICAgICAgZm9udC1zaXplOiAzMHB4O1xuICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICB9XG4gICAgXG4gICAgLnN1YmlyOmhvdmVye1xuICAgICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcbiAgICB9XG59XG5cbmgxe1xuICAgIGZvbnQtc2l6ZTogNDBweDtcbiAgICBjb2xvcjogd2hpdGU7XG4gICAgZm9udC1mYW1pbHk6IFJvYm90bywgc2Fucy1zZXJpZjtcbiAgICBmb250LXdlaWdodDogNDUwO1xufVxuXG5mb3Jte1xuICAgIHBhZGRpbmc6IDAgNDUwcHg7XG5cbiAgICBsYWJlbHtcbiAgICAgICAgZm9udC1zaXplOiAyOHB4O1xuICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgfVxuXG4gICAgOjpwbGFjZWhvbGRlciB7XG4gICAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgICAgb3BhY2l0eTogMTtcbiAgICB9IFxuXG4gICAgLnRleHRvcyB7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBtaW4td2lkdGg6IDE1MHB4O1xuICAgICAgICByZXNpemU6IG5vbmU7XG4gICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgZm9udC1mYW1pbHk6IFJvYm90bywgJ0hlbHZldGljYSBOZXVlJywgc2Fucy1zZXJpZjtcbiAgICAgICAgZm9udC1zaXplOiAyMnB4O1xuICAgICAgICBsaW5lLWhlaWdodDogMjRweDtcbiAgICAgICAgb3V0bGluZTogbm9uZTsgLyogUmVtb3ZlIGEgYm9yZGEgYW8gZm9jYXIgbm8gdGV4dGFyZWEgKi9cbiAgICB9XG5cbiAgICAuYWxpZ24tdmVydGljYWx7XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4O1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBnYXA6IDMwcHg7XG4gICAgfVxuICAgIFxufVxuXG4uaW52ZXN0aWdhdGV7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIGhlaWdodDogMTAwJTtcbiAgICBib3JkZXI6IHRyYW5zcGFyZW50O1xuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigxNDUsMjI1LDU0KTtcbiAgICB3aWR0aDogNzVweDtcbiAgICB0b3A6IDA7XG4gICAgcmlnaHQ6IDA7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xufVxuXG4uZW5nYWdlLWNvbnRhaW5lciB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIG1hcmdpbi1ib3R0b206IDIwcHg7IC8qIEFkZCBtYXJnaW4tYm90dG9tIHRvIGNyZWF0ZSBzcGFjZSBiZXR3ZWVuIGltYWdlIGFuZCBoMSAqL1xufVxuICBcbi5lbmdhZ2UtaW1hZ2Uge1xuICAgIG1hcmdpbi1yaWdodDogMjBweDsgLyogQWRqdXN0IHRoZSBtYXJnaW4tcmlnaHQgYXMgbmVlZGVkICovXG59XG4gIFxuLmVuZ2FnZS10aXRsZSB7XG4gICAgbWFyZ2luLXRvcDogMjBweDsgLyogUmVzZXQgdGhlIGxlZnQgbWFyZ2luICovXG59XG5cbi8vIC5lc3NlbnRpYWwtcXVlc3Rpb25pbmctY29udGFpbmVye1xuLy8gICAgIG1hcmdpbi1sZWZ0OiAxMDBweDtcbi8vIH1cblxuLmVzc2VudGlhbC1xdWVzdGlvbmluZ3tcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjUyLDQzLDIyKTtcbiAgICBib3JkZXI6IDJweCBzb2xpZCB3aGl0ZTtcbiAgICBjb2xvcjogd2hpdGU7XG4gICAgcGFkZGluZzogMTZweCAzMnB4O1xuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICBmb250LXNpemU6IDE2cHg7XG4gICAgbWFyZ2luOiAyNTBweCAycHg7XG4gICAgb3BhY2l0eTogMC42O1xuICAgIHRyYW5zaXRpb246IDAuM3M7XG4gICAgaGVpZ2h0OiA2MHB4O1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIG1hcmdpbi1sZWZ0OiAxMDBweDtcbiAgICBtYXJnaW4tdG9wOiAxMHB4O1xuICAgIG1hcmdpbi1ib3R0b206IDA7XG59XG5cbi5lc3NlbnRpYWwtcXVlc3Rpb25pbmc6aG92ZXIge29wYWNpdHk6IDF9XG5cbi50aXRsZS1hcmNoaXZle1xuICAgIG1hcmdpbi1sZWZ0OiAxMDBweDtcbiAgICBmb250LXNpemU6IDE0cHg7XG4gICAgY29sb3I6IHdoaXRlO1xufVxuXG4uYnV0dG9uLWFyY2hpdmV7XG4gICAgbWFyZ2luLWxlZnQ6IDEwMHB4O1xuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigxLDE1NSwxNTgpO1xuICAgIGJvcmRlcjogMnB4IHNvbGlkIHdoaXRlO1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgZm9udC1zaXplOiAxNHB4O1xuICAgIG9wYWNpdHk6IDAuNjtcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xuICAgIGhlaWdodDogMzBweDtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbn1cblxuLmJ1dHRvbi1hcmNoaXZlOmhvdmVyIHtvcGFjaXR5OiAxfVxuXG4uZmlsZS1saXN0IHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBoZWlnaHQ6IDYwdmg7XG59XG4gIFxuLmZpbGUtbGlzdCA+IGRpdiB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogcm93O1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgZ2FwOiAxMHB4OyAvKiBFc3Bhw4PCp2FtZW50byBlbnRyZSBvcyBlbGVtZW50b3MgKi9cbn1cbiAgXG4uZmlsZS1saXN0ID4gZGl2IHAge1xuICAgIG1hcmdpbjogMDsgLyogUmVtb3ZlciBtYXJnZW0gcGFkcsODwqNvICovXG59XG5cbi5zdGVwLWNvbnRhaW5lcntcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjYyNjI2O1xuICAgIHBhZGRpbmc6IDIwcHg7XG4gICAgYm9yZGVyLXJhZGl1czogMTBweDtcbn1cblxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"names":["Validators","i0","ɵɵelementStart","ɵɵlistener","EngageComponent_div_28_Template_textarea_keydown_enter_1_listener","$event","restoredCtx","ɵɵrestoreView","_r8","i_r6","index","ctx_r7","ɵɵnextContext","ɵɵresetView","onFormSubmit","ɵɵelementEnd","ɵɵproperty","EngageComponent_div_36_Template_textarea_keydown_enter_1_listener","_r12","i_r10","ctx_r11","EngageComponent_div_44_Template_textarea_keydown_enter_1_listener","_r16","i_r14","ctx_r15","ɵɵtext","ɵɵadvance","ɵɵtextInterpolate1","file_r17","name","ɵɵelement","image_r18","value","ɵɵsanitizeUrl","EngageComponent","toggleMenu","sidebarService","toggleSidebar","constructor","fb","engageService","dialog","dialogRef","progressService","engageData","big_idea","essential_question","challenge","isMenuHidden","files","renderedFiles","images","fileReader","FileReader","objectUrls","ngOnInit","engageForm","group","array","createField","loadEngageData","getEngage","subscribe","next","response","data","populateForm","console","log","error","setFields","convertToArray","Array","isArray","trim","split","fieldName","fieldData","formArray","get","clear","forEach","push","content","required","bigIdeaFields","essentialQuestionFields","challengeFields","addFields","count","control","i","saveDataWithDebounce","formData","saveTimeout","clearTimeout","setTimeout","saveData","event","preventDefault","fieldArray","field","at","valid","fieldValue","splice","createOrUpdateEngage","updateProgress","answeredQuestions","engageProgress","Math","round","totalQuestions","onFileSelected","inputElement","target","length","file","renderType","determineRenderType","renderedFile","downloadUrl","getFileUrl","type","includes","url","URL","createObjectURL","cleanupObjectUrls","revokeObjectURL","downloadFile","a","document","createElement","href","download","click","handleKeyboardEvent","key","debounceTimer","openModal","then","ModalComponent","open","width","afterClosed","processFiles","fileArray","from","isImage","imageRenderer","startsWith","onload","result","readAsDataURL","autoResize","scrollHeight","clientHeight","style","height","_","ɵɵdirectiveInject","i1","FormBuilder","i2","EngageService","i3","MatDialog","MatDialogRef","i4","ProgressService","i5","SidebarService","_2","selectors","hostBindings","EngageComponent_HostBindings","rf","ctx","ɵɵresolveDocument","ɵɵtemplate","EngageComponent_div_28_Template","EngageComponent_div_36_Template","EngageComponent_div_44_Template","EngageComponent_div_45_Template","EngageComponent_div_46_Template","controls"],"sources":["C:\\Users\\j-mai\\Documents\\CBLXToolPFP\\frontend\\src\\app\\pages\\engage\\engage.component.ts","C:\\Users\\j-mai\\Documents\\CBLXToolPFP\\frontend\\src\\app\\pages\\engage\\engage.component.html"],"sourcesContent":["// engage.component.ts\r\nimport { Component, HostListener, OnInit } from '@angular/core';\r\nimport { ProgressService } from '../../services/progress.service';\r\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\r\nimport { ModalComponent } from '@app/components/modal/modal.component';\r\nimport { EngageService } from '@app/services/engage.service';\r\nimport { FormArray, FormControl, FormGroup, Validators, FormBuilder} from '@angular/forms';\r\nimport { Observable } from 'rxjs';\r\nimport { SidebarService } from '../../../app/services/sidebar.service'\r\n\r\n@Component({\r\n  selector: 'app-engage',\r\n  templateUrl: './engage.component.html',\r\n  styleUrls: ['./engage.component.scss'],\r\n})\r\nexport class EngageComponent implements OnInit{\r\n  \r\n  engageData: {\r\n    [key: string]: string[];  // Allow indexing with a string key\r\n    big_idea: string[];\r\n    essential_question: string[];\r\n    challenge: string[];\r\n  } = { big_idea: [], essential_question: [], challenge: [] };\r\n  \r\n  \r\n  isMenuHidden: boolean = true;  // Explicitly declare boolean type (optional)\r\n  files: File[] = [];  // No changes needed, already correctly typed\r\n  renderedFiles: RenderedFile[] = [];  // Properly typed with the interface defined\r\n  images: { name: string; value: string }[] = [];  // No changes needed, correctly typed\r\n\r\n  engageForm!: FormGroup;  // Initialized in ngOnInit, so non-null assertion is fine\r\n\r\n  private debounceTimer!: ReturnType<typeof setTimeout>;  // Correct type declaration for debounceTimer\r\n  private fileReader: FileReader = new FileReader();  // No changes needed, properly initialized\r\n  private objectUrls: string[] = [];  // Initialized properly to hold URLs\r\n  private saveTimeout!: ReturnType<typeof setTimeout>; // Declare saveTimeout\r\n\r\n\r\n  toggleMenu(): void {\r\n    this.sidebarService.toggleSidebar();  // Delegate toggling to the SidebarService\r\n  }\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private engageService: EngageService,\r\n    public dialog: MatDialog,\r\n    public dialogRef: MatDialogRef<ModalComponent>,\r\n    private progressService: ProgressService,\r\n    private sidebarService: SidebarService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.engageForm = this.fb.group({\r\n      big_idea: this.fb.array([this.createField()]),\r\n      essential_question: this.fb.array([this.createField()]),\r\n      challenge: this.fb.array([this.createField()]),\r\n    });\r\n\r\n    this.loadEngageData();\r\n  }\r\n\r\n  loadEngageData(): void {\r\n    this.engageService.getEngage().subscribe({\r\n      next: (response) => {\r\n        if (response.data) {\r\n          this.engageData = response.data;\r\n          this.populateForm();\r\n          console.log('Engage data loaded successfully', this.engageData);\r\n        } else {\r\n          console.error('Unexpected response format:', response);\r\n        }\r\n      },\r\n      error: (error) => console.error('Failed to load engage data:', error),\r\n    });\r\n  }\r\n  \r\n\r\n  populateForm(): void {\r\n    // Destructure engageData with default values\r\n    const { big_idea = '', essential_question = '', challenge = '' } = this.engageData;\r\n  \r\n    // Convert to arrays properly\r\n    this.setFields('big_idea', this.convertToArray(big_idea));\r\n    this.setFields('essential_question', this.convertToArray(essential_question));\r\n    this.setFields('challenge', this.convertToArray(challenge));\r\n  }\r\n  \r\n  // Update this function to handle empty strings correctly\r\n  convertToArray(data: string | string[]): string[] {\r\n    if (Array.isArray(data)) {\r\n      return data;\r\n    } else if (typeof data === 'string') {\r\n      if (data.trim() === '') {\r\n        return ['']; // Return array with an empty string to create a text area\r\n      }\r\n      return data.split(','); // Split by commas or another delimiter if needed\r\n    }\r\n    return []; // Return an empty array if the data is null or not a valid string\r\n  }\r\n  \r\n  \r\n  \r\n  setFields(fieldName: string, fieldData: string[]): void {\r\n    const formArray = this.engageForm.get(fieldName) as FormArray;\r\n    formArray.clear(); // Clear existing FormArray\r\n    \r\n    // Create form controls for each entry in fieldData, including empty strings\r\n    fieldData.forEach(data => {\r\n      formArray.push(this.fb.group({\r\n        content: [data, Validators.required],\r\n      }));\r\n    });\r\n  }\r\n  \r\n\r\n  get bigIdeaFields(): FormArray {\r\n    return this.engageForm.get('big_idea') as FormArray;\r\n  }\r\n\r\n  get essentialQuestionFields(): FormArray {\r\n    return this.engageForm.get('essential_question') as FormArray;\r\n  }\r\n\r\n  get challengeFields(): FormArray {\r\n    return this.engageForm.get('challenge') as FormArray;\r\n  }\r\n\r\n  createField(): FormGroup {\r\n    return this.fb.group({\r\n      content: ['', Validators.required],\r\n    });\r\n  }\r\n\r\n  addFields(fieldName: string, count: number): void {\r\n    const control = this.engageForm.get(fieldName) as FormArray;\r\n    \r\n    // Instead of pushing multiple at once, map through and add each individually\r\n    for (let i = 0; i < count; i++) {\r\n      control.push(this.createField());\r\n    }\r\n  }\r\n  \r\n  saveDataWithDebounce(formData: { [key: string]: string[] }): void {\r\n    // Clear the existing timeout if there's one\r\n    if (this.saveTimeout) clearTimeout(this.saveTimeout);\r\n  \r\n    // Set a new timeout to debounce the save operation\r\n    this.saveTimeout = setTimeout(() => {\r\n      this.saveData(formData).subscribe({\r\n        next: (response) => console.log('Data saved successfully', response),\r\n        error: (error) => console.error('Failed to save data:', error),\r\n      });\r\n    }, 500); // Adjust debounce time as needed\r\n  }\r\n  \r\n\r\n  onFormSubmit(event: Event, fieldName: string, index: number): void {\r\n    event.preventDefault();\r\n  \r\n    const fieldArray = this.engageForm.get(fieldName) as FormArray;\r\n    const field = fieldArray.at(index); // Get the specific field by index\r\n  \r\n    if (!field.valid) {\r\n      console.log('Field is empty or invalid. Aborting submission.');\r\n      return;\r\n    }\r\n  \r\n    // Get the new value from the form field\r\n    const fieldValue = field.get('content')?.value.trim();\r\n  \r\n    if (fieldValue) {\r\n      // Ensure engageData is properly updated\r\n      if (Array.isArray(this.engageData[fieldName])) {\r\n        // If engageData[fieldName] is an array, update it accordingly\r\n        this.engageData[fieldName].splice(index, 1, fieldValue);\r\n      } else {\r\n        // Otherwise, assign the new value directly\r\n        this.engageData[fieldName] = fieldValue;\r\n      }\r\n    }\r\n  \r\n    // Save all filled fields with debounce to avoid repeated saves\r\n    this.saveDataWithDebounce(this.engageData);\r\n  \r\n    // Optionally, add a new field after the current one is submitted\r\n    this.addFields(fieldName, 1);\r\n  }\r\n  \r\n\r\n  saveData(formData: any): Observable<any> {\r\n    return this.engageService.createOrUpdateEngage(formData);\r\n  }\r\n\r\n  updateProgress() {\r\n    this.progressService.answeredQuestions++;\r\n    this.progressService.engageProgress = Math.round((this.progressService.answeredQuestions / this.progressService.totalQuestions) * 100);\r\n  }\r\n\r\n  onFileSelected(event: any): void {\r\n    const inputElement = event?.target as HTMLInputElement;\r\n    if (inputElement && inputElement.files) {\r\n      const files: FileList = inputElement.files;\r\n      for (let i = 0; i < files.length; i++) {\r\n        const file: File = files[i];\r\n        const renderType = this.determineRenderType(file);\r\n        const renderedFile: RenderedFile = { file, renderType };\r\n        if (renderType === 'pdf') {\r\n          renderedFile.downloadUrl = this.getFileUrl(file);\r\n        }\r\n        this.renderedFiles.push(renderedFile);\r\n      }\r\n    }\r\n  }\r\n\r\n  determineRenderType(file: File): 'image' | 'pdf' | 'other' {\r\n    if (file.type.includes('image')) {\r\n      return 'image';\r\n    } else if (file.type.includes('pdf')) {\r\n      return 'pdf';\r\n    } else {\r\n      return 'other';\r\n    }\r\n  }\r\n\r\n  getFileUrl(file: File): string {\r\n    const url = URL.createObjectURL(file);\r\n    this.objectUrls.push(url); // Track URLs for cleanup\r\n    return url;\r\n  }\r\n  \r\n  cleanupObjectUrls(): void {\r\n    this.objectUrls.forEach(url => URL.revokeObjectURL(url));\r\n    this.objectUrls = [];\r\n  }\r\n  \r\n  downloadFile(file: File) {\r\n    const url = this.getFileUrl(file);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = file.name;\r\n    a.click();\r\n  }\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n    if (event.key === '/') {\r\n      clearTimeout(this.debounceTimer);\r\n      this.debounceTimer = setTimeout(() => this.openModal(), 300);\r\n    }\r\n  }\r\n\r\n\r\n  openModal(): void {\r\n    import('@app/components/modal/modal.component').then(({ ModalComponent }) => {\r\n      const dialogRef = this.dialog.open(ModalComponent, {\r\n        width: '250px',\r\n      });\r\n  \r\n      dialogRef.afterClosed().subscribe((files: FileList | null) => {\r\n        if (files && files.length > 0) {\r\n          this.processFiles(files); // Delegate file processing to a helper method\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  // Helper method to process files\r\n  private processFiles(files: FileList): void {\r\n    const fileArray = Array.from(files); // Convert FileList to an array once\r\n\r\n    fileArray.forEach(file => {\r\n      if (this.isImage(file)) {\r\n        this.imageRenderer(file); // Process image files\r\n      } else {\r\n        this.files.push(file); // Store non-image files in this.files\r\n      }\r\n    });\r\n\r\n    // Optional: Log the processed files or remove this in production\r\n    console.log('Non-image files:', this.files);\r\n  }\r\n\r\n  // Check if the file is an image based on its type\r\n  private isImage(file: File): boolean {\r\n    return file.type.startsWith('image/');\r\n  }\r\n\r\n // Image rendering method\r\n  private imageRenderer(file: File): void {\r\n    this.fileReader.onload = () => {\r\n      this.images.push({\r\n        name: file.name,\r\n        value: this.fileReader.result as string // Store image as base64 string\r\n      });\r\n    };\r\n    this.fileReader.readAsDataURL(file); // Read the image file as a Data URL\r\n  }\r\n  \r\n  autoResize(event: any) {\r\n    const target = event.target;\r\n    if (target.scrollHeight !== target.clientHeight) {\r\n      target.style.height = 'auto';\r\n      target.style.height = target.scrollHeight + 'px';\r\n    }\r\n  }\r\n\r\n  \r\n}\r\n\r\ninterface RenderedFile {\r\n  file: File;\r\n  renderType: 'image' | 'pdf' | 'other';\r\n  downloadUrl?: string;\r\n}\r\n\r\n\r\n","<header>\r\n  <div class=\"cabecalho\">\r\n    <div class=\"tree\">\r\n      <!-- <app-togglemenu class=\"toggle-menu\"></app-togglemenu> -->\r\n      Projetos > <a routerLink=\"/jornada\" class=\"subir\">Projeto CBL</a> > <b> Engage</b>\r\n    </div>\r\n    <div class=\"navegacao\">\r\n      <ul>\r\n        <li class=\"nav-engage-select\">Engage</li>\r\n        <li><a routerLink=\"/investigate\" class=\"nav-acessar\">Investigate</a></li>\r\n        <li><a routerLink=\"/act\" class=\"nav-acessar\">Act</a></li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</header>\r\n<app-menu></app-menu>\r\n\r\n<body>\r\n\r\n  <!-- <button class=\"essential-questioning\" (click)=\"openModal()\">+ Essential Questioning</button> -->\r\n\r\n  <!-- <div class=\"engage-container\">\r\n    <img src=\"../../../assets/images/engage.jpeg\" class=\"engage-image\" alt=\"Engage Image\">\r\n    <h1 class=\"engage-title\">Engage</h1>\r\n  </div> -->\r\n\r\n  <form [formGroup]=\"engageForm\">\r\n    <div formArrayName=\"big_idea\" class=\"step-container\">\r\n      <label class=\"align-vertical\">\r\n        <img src=\"../../../assets/images/big_idea.png\" alt=\"lampada\">\r\n        Big Idea\r\n      </label><br><br>\r\n      <div *ngFor=\"let field of bigIdeaFields.controls; let i = index\" [formGroupName]=\"i\">\r\n        <textarea class=\"textos\" formControlName=\"content\" (keydown.enter)=\"onFormSubmit($event, 'big_idea', i)\" type=\"text\"></textarea>\r\n      </div>\r\n    </div>\r\n    <br>\r\n    <div formArrayName=\"essential_question\" class=\"step-container\">\r\n      <label class=\"align-vertical\">\r\n        <img src=\"../../../assets/images/essential_question.png\" alt=\"pensando\">\r\n        Essential Question\r\n      </label><br><br>\r\n      <div *ngFor=\"let field of essentialQuestionFields.controls; let i = index\" [formGroupName]=\"i\">\r\n        <textarea class=\"textos\" formControlName=\"content\" (keydown.enter)=\"onFormSubmit($event, 'essential_question', i)\" type=\"text\"></textarea>\r\n      </div>\r\n    </div>\r\n    <br>\r\n    <div formArrayName=\"challenge\" class=\"step-container\">\r\n      <label class=\"align-vertical\">\r\n        <img src=\"../../../assets/images/challenge.png\" alt=\"alvo\">\r\n        Challenge\r\n      </label><br><br>\r\n      <div *ngFor=\"let field of challengeFields.controls; let i = index\" [formGroupName]=\"i\">\r\n        <textarea class=\"textos\" formControlName=\"content\" (keydown.enter)=\"onFormSubmit($event, 'challenge', i)\" type=\"text\"></textarea>\r\n      </div>\r\n    </div>\r\n  </form>\r\n\r\n  <div class=\"archives\" *ngFor=\"let file of files\">\r\n    <p class=\"title-archive\">Arquivo: {{ file.name }}</p>\r\n    <!-- Uncomment this line to enable file download functionality -->\r\n    <!-- <a [href]=\"getFileUrl(file)\" (click)=\"downloadFile(file)\"><button class=\"button-archive\" type=\"button\">Download</button></a> -->\r\n  </div>\r\n\r\n  <div class=\"images\" *ngFor=\"let image of images\">\r\n    <img [src]=\"image.value\" alt=\"Uploaded Image\">\r\n  </div>\r\n\r\n  <!-- <a routerLink=\"/investigate\"><button class=\"investigate\" type=\"button\"></button></a> -->\r\n</body>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}